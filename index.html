<html>
    <head>
        <script src="lib/angular.js"></script>
        <script src="lib/lodash.js"></script>
        <script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>
        <script>
            var myApp = angular.module('myApp', []);
            myApp.controller('GradeSheetCtrl', ['$scope',
                function($scope) {
                    $scope._ = _;
                    $scope.entries = [
                        { name: 'Wendy', grade: 72 },
                        { name: 'Jacob', grade: 63 },
                        { name: 'Harris', grade: 87 },
                        { name: 'Penelope', grade: 94 }
                    ];
                    $scope.delete = function(index) {
                        $scope.entries.splice(index, 1);
                    }
                    $scope.averageIteratee = function(accumulator, value, index, collection) {
                        return accumulator + value.grade / collection.length;
                    };
                }
            ]);
            myApp.controller('NewEntryCtrl', ['$scope',
                function($scope) {
                    $scope.newEntry = {};

                    function canCreate() {
                        return angular.isString($scope.newEntry.name)
                            && angular.isNumber($scope.newEntry.grade);
                    }

                    $scope.create = function() {
                        if (canCreate()) {
                            $scope.entries.push($scope.newEntry);
                            $scope.newEntry = {};
                        }
                    }
                }
            ]);
            myApp.directive('updateOnEnterInput', function() {
                return {
                    restrict: 'E',
                    // Must replace the original update-on-enter-input element so that additional
                    // attributes are added to the input in the directive template
                    replace: true,
                    template: '<input ng-model=\"model\" ng-model-options=\"{updateOn: \'change blur\'}\"></input>',
                    scope: {
                        model: '='
                    }
                }
            });
        </script>
        <style type="text/css">
            input:focus { border: 2px solid green; }
            .failing { border: 2px solid red; }
        </style>
        <link rel="stylesheet" href="lib/bootstrap-3.3.5-dist/css/bootstrap.css"></link>
    </head>
    <body ng-app="myApp">
        <h1>Grade Sheet</h1>
        <div class="container-fluid" ng-controller="GradeSheetCtrl">
            <div class="row">
                <div class="col-xs-12 col-md-7" style="background-color: AliceBlue;">
                    <h3>Student Grades<h3>
                    <table class="table">
                        <tr ng-repeat="($index, entry) in entries">
                            <td>{{$index}}</td>
                            <td><update-on-enter-input model="entry.name" type="text"></update-on-enter-input></td>
                            <td><update-on-enter-input model="entry.grade" type="number" ng-class="{failing: entry.grade < 65}"></update-on-enter-input></td>
                            <td><button class="btn" ng-click="delete($index)">delete</button></td>
                        </tr>
                        <tr ng-controller="NewEntryCtrl">
                            <td>New:</td>
                            <td><input ng-model="newEntry.name" type="text" ng-keyup="$event.keyCode == 13 && create()"></input></td>
                            <td><input ng-model="newEntry.grade" type="number" ng-keyup="$event.keyCode == 13 && create()"></input></td>
                            <td><button class="btn" ng-click="create()">create</button></td>
                        </tr>
                    </table>
                </div>
                <div class="col-xs-12 col-md-5" style="background-color: LemonChiffon;">
                    <h3>Summary</h3>
                    <table class="table">
                        <tr>
                            <td><label>Max:</label></td>
                            <td>{{ _(entries).max('grade').grade }}</td>
                        </tr>
                        <tr>
                            <td><label>Average:</label></td>
                            <td>{{ _(entries).reduce(averageIteratee, 0) }}</td>
                        </tr>
                        <tr>
                            <td><label>Min:</label></td>
                            <td>{{ _(entries).min('grade').grade }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </body>
</html>

